"use strict";(self.webpackChunkcloud_trade_sdk=self.webpackChunkcloud_trade_sdk||[]).push([[603],{61603:(e,t,r)=>{r.r(t),r.d(t,{default:()=>q});var n=r(52322),i=r(2784),s=r(75486),c=r.n(s),a=r(17335),o=r(82732),u=r(436),l=r(3707),y=r(57005),m=r(671),p=(r(86067),r(4673)),d=r(62252),v=r(51609),b=r(66747),f=r(20115),h=r(21414),k=r(72869),g=r(14279),T=r(40943),D=r(94190),M=r(84972),I=r(25072),O=r(31161);const S=({symbol:e,type:t,priceType:r})=>`${e}@${t}@${r}`,x=e=>{const[t,r,n]=e.split("@");return{symbol:t,type:r,priceType:n}};var C=function(e,t,r,n){return new(r||(r=Promise))((function(i,s){function c(e){try{o(n.next(e))}catch(e){s(e)}}function a(e){try{o(n.throw(e))}catch(e){s(e)}}function o(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(c,a)}o((n=n.apply(e,t||[])).next())}))};const{brandName:P=""}=window.brokerConfig,w=[p.ls.TRADING,p.ls.DELIVERING],j={1:"1m",3:"3m",5:"5m",15:"15m",30:"30m",60:"1h",120:"2h",240:"4h",360:"6h",480:"8h",720:"12h","1D":"1d","3D":"3d","1W":"1w","1M":"1M"};var F;!function(e){e.Futures="futures",e.FuturesMark="futures-mark",e.FuturesIndex="futures-index",e.Delivery="delivery",e.DeliveryMark="delivery-mark",e.DeliveryIndex="delivery-index"}(F||(F={}));const V=({ticker:e,name:t,productType:r,pricePrecision:n})=>({name:t,fullName:t,description:t,ticker:e,tickSize:Math.pow(10,n),exchange:P,supportedResolutions:a.k.DefaultResolutions,type:r});var $=r(45873);var L=r(23716),E=function(e,t,r,n){return new(r||(r=Promise))((function(i,s){function c(e){try{o(n.next(e))}catch(e){s(e)}}function a(e){try{o(n.throw(e))}catch(e){s(e)}}function o(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(c,a)}o((n=n.apply(e,t||[])).next())}))};const R="myTradingView",A=e=>{[l.sy,l.O7].map((e=>c().createInstance({name:e}))).forEach((t=>t.setItem(R,e)))},q=({symbol:e,namespace:t,useMiniTicker:r=!1})=>{const s=a.k.Store.createStore(t),[p]=s(a.k.Store.getInterval),[q]=s(a.k.Store.getPriceType),B=(0,o.Vh)(),{contractType:U}=B[e]||{},{datafeed:_,symbolsInfo:N}=(({namespace:e,useMiniTicker:t=!1})=>{const r=a.k.Store.createStore(e),{getI18n:n}=(0,d.ZK)("trd-chart","trade-ui"),{getI18n:s}=(0,d.yk)(),c=(0,o.Vh)(),u=(0,i.useRef)(c),{isContUnit:l}=(0,O.Q)(),y=(0,o._n)(),[m]=r(a.k.Store.getPriceType),p=(0,i.useRef)(y),v=(0,i.useRef)(m);u.current=c,p.current=y,v.current=m;const b=(0,i.useMemo)((()=>l?I.D:I.V),[l]),f=(0,i.useMemo)((()=>s("usdtFutures-13",{defaultValue:"Futures"})||""),[s]),h=(0,i.useMemo)((()=>s("inverseFutures-13",{defaultValue:"Delivery"})||""),[s]),$=(0,i.useMemo)((()=>n("indexPrice",{defaultValue:"Index Price"})||""),[n]),L=(0,i.useMemo)((()=>n("markPrice",{defaultValue:"Mark Price"})||""),[n]),E=(0,i.useMemo)((()=>n("lastPrice",{defaultValue:"Last Price"})||""),[n]),R=(0,i.useMemo)((()=>({exchanges:[{name:P,value:P,desc:""}],symbols_types:[{name:f,value:F.Futures},{name:`${f} ${L}`,value:F.FuturesMark},{name:`${f} ${$}`,value:F.FuturesIndex}]})),[h,f,$,L]),A=(0,i.useCallback)((()=>C(void 0,void 0,void 0,(function*(){try{yield(({checker:e,interval:t=1e3,timeout:r=1e4})=>{let n;return Promise.race([new Promise((r=>{n=setInterval((()=>e()&&r()),t)})),new Promise(((e,t)=>{setTimeout((()=>t(new Error("timeout"))),r)}))]).finally((()=>clearInterval(n)))})({checker:()=>Object.keys(u.current).length>0})}catch(e){}const e=u.current;return Object.keys(e).reduce(((t,r)=>{const{symbol:n,pricePrecision:i,isDelivery:c,contractStatus:o,contractType:u}=e[r];if(!w.includes(o))return t;const{symbol:l,contractTypeI18n:y,deliveryDateFormat:m}=(0,k.H)(e[r],s),p=`${l} ${y}${m?` ${m}`:""}`,d=S({symbol:n,type:u,priceType:a.k.Store.PriceType.Last}),v=S({symbol:n,type:u,priceType:a.k.Store.PriceType.Index}),b=S({symbol:n,type:u,priceType:a.k.Store.PriceType.Mark});return t[d]=V({ticker:d,name:`${p} ${E}`,productType:c?F.Delivery:F.Futures,pricePrecision:i}),t[v]=V({ticker:v,name:`${p} ${$}`,productType:c?F.DeliveryIndex:F.FuturesIndex,pricePrecision:i}),t[b]=V({ticker:b,name:`${p} ${L}`,productType:c?F.DeliveryMark:F.FuturesMark,pricePrecision:i}),t}),{})}))),[s,$,L,E]),q=(0,i.useCallback)((({symbolInfo:e,resolution:t,rangeStartDate:r,rangeEndDate:n})=>C(void 0,void 0,void 0,(function*(){const i=u.current,{symbol:s="",priceType:c=v.current}=x(e.ticker||""),{pair:a,contractType:o,contractVal:l,isDelivery:y}=i[s],m=Math.max(0,1e3*r),p=1e3*n,d=j[t],f=y?b(l):e=>e,h=(0,M.b)({symbol:s,pair:a,contractType:o,interval:d,isDelivery:y,priceType:c});return(yield(0,D.M)({onFetchKlineData:h,startTime:m,endTime:p})).map(f)}))),[b]),B=(0,i.useCallback)((({symbolInfo:e,resolution:r,callback:n})=>{const i=u.current,{symbol:s="",priceType:c=v.current}=x(e.ticker||""),{pair:a,contractType:o,contractVal:l,isDelivery:y}=i[s],m=j[r],p=y?b(l):e=>e;return(0,T.Ld)({symbol:s,pair:a,contractType:o,interval:m,priceType:c,isDelivery:y,useMiniTicker:t,checkIfInSync:()=>!0,callback:e=>n(p(e))})}),[b,t]),U=(0,i.useCallback)((()=>C(void 0,void 0,void 0,(function*(){const{serverTime:e}=yield(0,g.b)(!0);return Math.floor(parseInt(`${e}`,10)/1e3)}))),[]),_=(0,i.useMemo)((()=>a.k.createDatafeed()),[]),{datafeed:N,symbolsInfo:H}=_({config:R,onFetchSymbolsInfo:A,onFetchBars:q,onSubscribeBars:B,onFetchServerTimeApi:U});return{datafeed:N,symbolsInfo:H}})({namespace:t,useMiniTicker:r}),H=(0,o.Fg)(),K="light"===H?m.ib:m.Cs,Q=(0,y.k)(H),W=p===a.k.Store.DisplayIntervals.Time?a.k.Store.DisplayIntervals["1m"]:p,G=(0,i.useMemo)((()=>c().createInstance({name:t})),[t]),J=(0,i.useMemo)((()=>S({symbol:e,type:U,priceType:q})),[e,U,q]),Y=(0,i.useRef)(-1),{executionOrders:Z}=(({symbol:e,namespace:t})=>{const r=a.k.OrderHistoryStore.createStore(t),[n]=r(a.k.OrderHistoryStore.getOrderHistory),{getI18n:s}=(0,d.KL)(),c=(({symbol:e})=>{const{getI18n:t}=(0,v.yk)(),r=(0,f.AM)(),{baseAsset:n,marginAsset:i,isDelivery:s}=r[e]||{},{unit:c}=(0,h.F7)();return s?c===b.SW.coin?n:t("Cont"):c===b.AO.usdt?i:n})({symbol:e}),u=(0,o.AM)(),{baseAsset:l,pricePrecision:y,quantityPrecision:m,equalQtyPrecision:p,isDelivery:k,contractVal:g}=u[e]||{},T=(0,i.useMemo)((()=>s("openOrder-sideBuyBOTH",{defaultValue:"Buy"})||""),[s]),D=(0,i.useMemo)((()=>s("openOrder-sideSellBOTH",{defaultValue:"Sell"})||""),[s]),M=(0,i.useMemo)((()=>{switch(c){case l:return k?p:m;default:return k?m:y}}),[k,c,l,p,y,m]),I=(0,i.useCallback)((({avgPrice:e,executedQty:t})=>k?(0,$.GW)(c===l?(({price:e,cont:t,contractVal:r})=>t*r/e)({price:e,cont:t,contractVal:g}):t,M):(0,$.mD)(c===l?t:t*e,M)),[l,g,k,M,c]);return{executionOrders:(0,i.useMemo)((()=>n.filter((({status:e,executedQty:t})=>"FILLED"===e.toUpperCase()||"PARTIAL FILL"===e.toUpperCase()||"PARTIALLY_FILLED"===e.toUpperCase()||"EXPIRED"===e.toUpperCase()&&t>0||"CANCELED"===e.toUpperCase()&&t>0)).map((({id:e,avgPrice:t,side:r,time:n,executedQty:i})=>{const s=`${"BUY"===r?T:D} ${I({avgPrice:t,executedQty:i})} @ ${(+t).toFixed(y)}`;return{id:e,text:"",price:+t,quantity:"",time:Math.round(n/1e3),isBuy:"BUY"===r,tooltip:s}}))),[n,T,D,I,y])}})({symbol:e,namespace:t}),X=(0,o.tZ)(),z=(0,l.GL)(X);(0,u.M)(e,r),(0,u.j)({symbol:e,interval:W,priceType:q});const ee=(0,i.useCallback)((()=>{Y.current=Date.now()}),[]),te=(0,i.useCallback)((e=>E(void 0,void 0,void 0,(function*(){return A(e)}))),[]),re=(0,i.useCallback)((()=>{}),[]),ne=(0,i.useCallback)((()=>E(void 0,void 0,void 0,(function*(){const e=yield G.getItem(R);A(e)}))),[G]),ie=(0,i.useCallback)((e=>L.log("tv-error",e)),[]),se=(0,i.useCallback)((()=>{}),[]),ce=(0,i.useCallback)((()=>{}),[]);return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(a.k.Containers.TradingView,{namespace:t,theme:K,storageName:R,tradingViewProps:{symbol:J,symbolsInfo:N,theme:Q,limitOrders:[],positionOrders:[],executionOrders:Z,initialConfig:{tvConfig:{library_path:"charting_library_next/",symbol:J,theme:Q,locale:z,datafeed:_},onScriptLoaded:ee,onSave:te,onChartReadyDone:re,onWillUnmount:ne,onCreateOrderShapesError:ie,onFirstTimeDataLoadedDone:se,onSetThemeDone:ce}}},void 0)},void 0)}},436:(e,t,r)=>{r.d(t,{j:()=>a,M:()=>o});var n=r(2784),i=r(4673),s=r(6612),c=r(20115);const a=({symbol:e,interval:t,priceType:r})=>{const{pair:a,contractType:o,isDelivery:u}=(0,c.Vh)()[e]||{},l=(0,n.useRef)();(0,n.useEffect)((()=>{if(!a||!o)return;const n="mark"===r?e:a;return l.current=void 0,(0,s.nJ)(t),(u?(0,i.RU)():(0,i.BN)()).getContinuousKlineStream(n,o,t,{priceType:r,symbol:e}).subscribe((e=>{l.current&&(e.time,l.current.time),l.current=e}))}),[a,e,t,o,r,u])},o=(e,t)=>{const{isDelivery:r}=(0,c.Vh)()[e]||{},s=(0,n.useRef)();(0,n.useEffect)((()=>{if(!t)return(r?(0,i.RU)():(0,i.BN)()).getStreamTradeSnap(e).subscribe((e=>{const t=e[e.length-1];s.current&&(t.tradeTime,s.current.tradeTime),s.current=t}))}),[r,e,t])}},84972:(e,t,r)=>{r.d(t,{b:()=>i});var n=r(6590);const i=({symbol:e,pair:t,contractType:r,interval:i,isDelivery:s,priceType:c})=>a=>s&&"last"===c?(0,n.kV)(Object.assign(Object.assign({},a),{pair:t,contractType:r,interval:i})):s&&"mark"===c?(0,n.uX)(Object.assign(Object.assign({},a),{symbol:e,interval:i})):s&&"index"===c?(0,n.te)(Object.assign(Object.assign({},a),{pair:t,interval:i})):"mark"===c?(0,n.C1)(Object.assign(Object.assign({},a),{symbol:e,interval:i})):"index"===c?(0,n.hH)(Object.assign(Object.assign({},a),{pair:t,interval:i})):(0,n.MZ)(Object.assign(Object.assign({},a),{pair:t,contractType:r,interval:i}))},94190:(e,t,r)=>{r.d(t,{M:()=>n});const n=({onFetchKlineData:e,startTime:t,endTime:r,limit:n=1e3})=>{return i=void 0,s=void 0,a=function*(){const i=[];let s=[],c=r;const a=0!==r;do{if(s=yield e(Object.assign(Object.assign({},0===c?{}:{endTime:c}),{limit:n})),0===s.length)break;s.forEach((([e,t,r,n,s,c,,a])=>{i.push({time:+e,open:+t,high:+r,low:+n,close:+s,volume:+c,quantity:+a})})),c=s[0][0]-1}while(s.length===n&&c>t&&a);return i.sort(((e,t)=>e.time-t.time)),i},new((c=void 0)||(c=Promise))((function(e,t){function r(e){try{o(a.next(e))}catch(e){t(e)}}function n(e){try{o(a.throw(e))}catch(e){t(e)}}function o(t){var i;t.done?e(t.value):(i=t.value,i instanceof c?i:new c((function(e){e(i)}))).then(r,n)}o((a=a.apply(i,s||[])).next())}));var i,s,c,a}},6612:(e,t,r)=>{r.d(t,{nJ:()=>n});const n=e=>{const[,t,r]=e.split(/(\d*)/),n=+t;switch(r){case"M":return 1e3*n*60*60*24*30;case"w":case"W":return 1e3*n*60*60*24*7;case"d":case"D":return 1e3*n*60*60*24;case"h":case"H":return 1e3*n*60*60;case"m":default:return 1e3*n*60}}},25072:(e,t,r)=>{r.d(t,{D:()=>i,V:()=>n});const n=e=>t=>Object.assign(Object.assign({},t),{volume:t.quantity,quantity:t.volume*e}),i=e=>t=>Object.assign(Object.assign({},t),{volume:t.volume,quantity:t.volume*e})},40943:(e,t,r)=>{r.d(t,{Ld:()=>o});var n=r(4673),i=r(6612),s=r(23716);const c=e=>e,a=e=>e,o=({symbol:e,pair:t,contractType:r,interval:o,priceType:u,isDelivery:l,useMiniTicker:y,callback:m,checkIfInSync:p=(()=>!0)})=>{const d=(0,n.BN)(),v="mark"===u?e:t,b=d.getContinuousKlineStream(v,r,o,{priceType:u,symbol:e});b.selector=c;const f=y?d.getStreamTickers():d.getStreamTradeSnap(e);f.selector=y?(e=>t=>t[e])(e):a;const h=function(e=[]){const t=[];function r(){t.forEach((e=>e()))}return r.subscribe=function(r){const n=[];e.forEach(((e,i)=>{const s=e.subscribe((t=>{n[i]=e.selector(t),r(n)}));t.push(s)}))},r}([b,f]);return h.subscribe((([e,t])=>{if(!t||!e||!p())return;const r=Object.assign({},e);if("last"===u){const e=Array.isArray(t)?t.slice(-1).pop():t,n=(0,i.nJ)(o),c=+(e.price||e.lastPrice),a=+(e.quantity||e.quoteVolume),u=e.tradeTime||e.eventTime;try{if("1M"===o){const e=new Date(u),t=new Date(r.time).getMonth();if(e.getMonth()>t){const e=+new Date(r.time).setMonth(t+1);Object.assign(r,Object.assign({time:e,open:c,high:c,low:c,close:c},y?{volume:0,quantity:0}:{volume:a,quantity:a}))}}else if(u-r.time>n){const e=r.time+Math.floor((u-r.time)/n)*n;Object.assign(r,Object.assign({time:e,open:c,high:c,low:c,close:c},y?{volume:0,quantity:0}:{volume:a,quantity:a}))}}catch(e){s.error(e)}r.close=c}m(r,e)})),h}}}]);