"use strict";(self.webpackChunkcloud_trade_sdk=self.webpackChunkcloud_trade_sdk||[]).push([[811],{78811:(e,t,n)=>{n.r(t),n.d(t,{default:()=>J});var i=n(52322),o=n(2784),r=n(27866),s=n(35635),l=n(82732),a=n(28906),c=n(78650),u=n(93613),d=n(79268),p=n(66747);const x="PLACE_ORDER_TYPE";var h=n(55438),v=n(97912);const{zIndices:b}=v.Z,g={userSelect:"none",fontSize:"12px",height:"40px",flexDirection:"column",alignItems:"center",justifyContent:"center",flexGrow:1,minWidth:"100px",borderTop:"2px solid",cursor:"pointer",lineHeight:"16px","&.buy-button":{":hover":{bg:e=>(0,h.DZ)(e.colors.buy,.7)},bg:e=>(0,h.DZ)(e.colors.buy,.15),borderColor:"buy"},"&.sell-button":{":hover":{bg:e=>(0,h.DZ)(e.colors.sell,.7)},bg:e=>(0,h.DZ)(e.colors.sell,.15),borderColor:"sell"},padding:"2px 0 3px",".title":{color:"t.secondary"},".text":{color:"t.primary"}},f={bg:"bg1",pt:"xs",".container":{width:"25px",mx:"2px",flexDirection:"column",alignItems:"center",cursor:"pointer",color:"t.third","&.active":{"& > div:first-of-type":{bg:"t.secondary"},color:"t.secondary"}},".stepper":{height:"10px",mb:"2px",width:"23px",bg:"bg3"},".value":{fontSize:"12px",transform:"scale(calc(10/12))",color:"t.third"},".position-value":{flex:1,fontSize:"12px",color:"t.secondary"}},m={minWidth:"312px",width:"auto",position:"absolute",zIndex:b.flashOrder,color:"white",minHeight:"40px",alignItems:"center",justifyContent:"space-between",bg:"popupBg","&.drag-hide":{display:"none"}},y={minWidth:"16px",width:"16px",justifyContent:"center",display:"flex",height:"40px",alignItems:"center",cursor:"grab",color:"icons.close",userSelect:"none",bg:"popupBg"},j={fontSize:"12px",flexDirection:"column",justifyContent:"center",minWidth:"100px",padding:"3px 4px 4px 4px",maxWidth:"150px",textAlign:"center",".amount":{"div.bn-input-tooltip":{bottom:"47px",width:"fit-content",left:"50%",transform:"translateX(-50%)","& .bn-input-tooltip-arrow":{left:"50%"},"& .bn-input-tooltip-content":{p:"7px 12px",width:"fit-content",whiteSpace:"nowrap"}},"div:not(.bn-input-tooltip):not(.bn-input-tooltip-arrow):not(.bn-input-tooltip-content)":{border:"none",margin:"0",height:"20px",input:{fontSize:"12px",textAlign:"center"}},".bn-input-prefix":{display:"none"}},"div:first-of-type":{color:"t.secondary"},input:{minWidth:"80px",maxWidth:"100px",width:"auto",bg:"popupBg",color:"t.primary"}},C={userSelect:"none",minWidth:"16px",width:"16px",height:"40px",justifyContent:"center",display:"flex",alignItems:"center",bg:"popupBg",".icon":{cursor:"pointer",flexShrink:0,color:"icons.close","&:hover":{color:"primary"}}},w=({positionDirection:e,type:t="bid",handleClick:n=(()=>{}),dispatch:r=(()=>{})})=>{const{BuyText:c,SellText:u}=(0,l.x_)(e);let d,p,h,v,b=a.PR.BOTH;const{bidPrice:f,askPrice:m}=(0,l.he)(),{positionMode:y}=(0,l.F7)();"bid"===t?(p=c,h=String(m),d="buy-button",v=1,y&&(e===a.RS.OPEN?b=a.PR.LONG:e===a.RS.CLOSE&&(b=a.PR.SHORT))):(p=u,h=String(f),d="sell-button",v=-1,y&&(e===a.RS.OPEN?b=a.PR.SHORT:e===a.RS.CLOSE&&(b=a.PR.LONG)));const j=(0,o.useCallback)((e=>{e.preventDefault(),r({type:x,payload:{side:v,positionSide:b}}),n(!0)}),[b,r,v,n]);return(0,o.useMemo)((()=>(0,i.jsxs)(s.Z,Object.assign({onClick:j,sx:g,className:d},{children:[(0,i.jsx)("div",Object.assign({className:"title"},{children:p}),void 0),(0,i.jsx)("div",Object.assign({className:"text"},{children:h}),void 0)]}),void 0)),[j,d,p,h])};var O=n(23154),R=n(72779),S=n.n(R),k=n(95970),Z=n(96353),E=n(42658);const N=/^\d+\.?\d*|%$/,T=/^0+(?=\d)/,P=o.memo((e=>{var{name:t,value:n,error:r,disabled:s=!1,precision:a,errorText:c,infoText:u,placeholder:d,onChange:p,maxLength:x,autoZero:h=!1,inputRef:v,onFocus:b,onBlur:g}=e,f=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(i=Object.getOwnPropertySymbols(e);o<i.length;o++)t.indexOf(i[o])<0&&Object.prototype.propertyIsEnumerable.call(e,i[o])&&(n[i[o]]=e[i[o]])}return n}(e,["name","value","error","disabled","precision","errorText","infoText","placeholder","onChange","maxLength","autoZero","inputRef","onFocus","onBlur"]);const m="rtl"===(0,l.gm)()?S()(Z.Z["alb-text-align"]):"",y=(0,o.useCallback)((e=>{let t=e.target.value;!0===h&&"string"==typeof t&&0===t.indexOf(".")&&(t=`0${t}`),!N.test(t)&&""!==t||isNaN(t)?e.stopPropagation():(t=t.replace(T,""),(0,E.N3)(t)>a&&(t=t.replace(new RegExp(`^(\\d*\\.\\d{${a}})\\d*`),"$1")),x&&t.split(".")[0].length>x&&(t=n),0===a&&(t=t.replace(".","")),p&&(t=p(t)),e.target.value=t)}),[p,x,a,n,h]),j=(0,o.useCallback)((e=>{const t=e.target.value;N.test(t)||(e.target.value=""),null==g||g(e)}),[g]),C=(0,o.useCallback)((e=>{e.target.value||(e.target.value="")}),[]);return(0,i.jsx)(k.Z,Object.assign({name:t,ref:v,variant:"inline",className:m,type:"text",value:n,placeholder:d,disabled:s,onClick:C,onChange:y,onBlur:j,onFocus:b,error:r,infoText:u,errorText:c},f),void 0)}));var M=n(62252),L=n(12266);const D=({inputRef:e,submitError:t,quantity:n="",setQuantity:r,dispatch:a,onFocus:c})=>{const{getI18n:u}=(0,M.yk)(),[d]=(0,l.eY)(),{cUnit:p,precision:h,helperText:v,minContQty:b,placeholder:g,buyCont:f,buyQty:m,sellCont:y,sellQty:C}=(0,l.ql)({quantity:n}),w=`${u("quantity")} (${p})`,R=!Number.isNaN(Number(n));return(0,o.useEffect)((()=>{a({type:x,payload:{minContQty:b,buyQty:m,sellQty:C,buyCont:f,sellCont:y}})}),[n,b,d]),(0,i.jsxs)(s.Z,Object.assign({sx:j},{children:[(0,i.jsx)("div",{children:w},void 0),(0,i.jsx)("div",Object.assign({className:"amount"},{children:(0,i.jsx)(P,{id:"flashOrderQuantity",inputRef:e,type:R?"number":"text",step:(0,L.nH)(h),precision:h,value:n,placeholder:g,maxLength:O.ze,error:Boolean(t),errorText:t,infoText:v,autoZero:!0,onChange:r,onFocus:c},void 0)}),void 0)]}),void 0)};var F=n(76940);var B=n(81379);const I={l:15,t:65,b:window.innerHeight-55,r:window.innerWidth-340},A=(window.innerHeight,window.innerWidth,{l:15,t:250}),Q=({draggableRef:e})=>(0,o.useMemo)((()=>(0,i.jsx)(s.Z,Object.assign({ref:e,sx:y},{children:(0,i.jsxs)("svg",Object.assign({width:"6",height:"12",viewBox:"0 0 6 12",fill:"none",xmlns:"http://www.w3.org/2000/svg"},{children:[(0,i.jsx)("rect",{width:"2",height:"2",fill:"currentColor"},void 0),(0,i.jsx)("rect",{y:"5",width:"2",height:"2",fill:"currentColor"},void 0),(0,i.jsx)("rect",{y:"10",width:"2",height:"2",fill:"currentColor"},void 0),(0,i.jsx)("rect",{x:"4",width:"2",height:"2",fill:"currentColor"},void 0),(0,i.jsx)("rect",{x:"4",y:"5",width:"2",height:"2",fill:"currentColor"},void 0),(0,i.jsx)("rect",{x:"4",y:"10",width:"2",height:"2",fill:"currentColor"},void 0)]}),void 0)}),void 0)),[e]),z=o.memo((({children:e,visible:t,draggableRef:n})=>{const{isIPad:r}=(0,M.Fs)(),[l,a]=(0,F.Z)("flash-order-position",A),c=I,u=(g=l,(f=(0,o.useRef)(g)).current=g,f),d=(0,o.useRef)(!0),p=(0,o.useRef)(!1),x=(0,B.xG)((e=>e.setDisableMouse)),h=(0,o.useRef)({x:0,y:0}),b=(0,o.useCallback)((e=>{p.current=!0,x(!0),h.current={x:e.screenX,y:e.screenY}}),[x]);var g,f;(0,o.useEffect)((()=>{var e,t;return null===(e=n.current)||void 0===e||e.addEventListener("mousedown",b),null===(t=n.current)||void 0===t||t.addEventListener("touchstart",b),()=>{const{current:e}=n;null==e||e.removeEventListener("mousedown",b),null==e||e.removeEventListener("touchstart",b)}}),[n,b]);const y=(0,o.useCallback)((e=>{e.preventDefault(),p.current=!1,x(!1)}),[x]),j=(0,o.useCallback)((e=>{setTimeout((()=>{if(e.preventDefault(),!p.current)return;const t=h.current,n=e.screenX-t.x,i=e.screenY-t.y;if(r){const t=window.innerWidth-e.changedTouches[0].clientX,n=window.innerWidth-e.changedTouches[0].clientY;return a({l:Math.min(I.r,Math.max(t,I.l)),t:Math.min(I.b,Math.max(n,I.t))})}const o=u.current;if(!o)return;const{l:s,t:l}=o,d=s+n,x=l+i;a({l:Math.min(c.r,Math.max(d,c.l)),t:Math.min(c.b,Math.max(x,c.t))}),h.current={x:e.screenX,y:e.screenY}}),15)}),[a,r,u]);return(0,o.useEffect)((()=>{if(d.current)return window.addEventListener(r?"touchmove":"mousemove",j),window.addEventListener(r?"touchend":"mouseup",y),d.current=!1,()=>{window.removeEventListener(r?"touchmove":"mousemove",j),window.removeEventListener(r?"touchend":"mouseup",y)}}),[y,j,r]),(0,i.jsx)(s.Z,Object.assign({sx:Object.assign(Object.assign({},m),{transform:`translate(${l?Math.max(l.l,I.l):A.l}px, ${l?Math.max(l.t,I.t):A.t}px)`,zIndex:p.current?v.Z.zIndices.flashOrder:9}),className:t?"":"drag-hide"},{children:e}),void 0)}));var W=n(34633);const H=({onRemove:e})=>(0,i.jsx)(s.Z,Object.assign({sx:C},{children:(0,i.jsx)(W.Z,{className:"icon",size:8,onClick:e},void 0)}),void 0);var $=n(20512),_=n(82696);const q=[25,50,75,100],Y=o.memo((({onClose:e,onChange:t,percent:n,setPercent:r,precision:a})=>{const{curMaxBuyAmount:c,curMaxSellAmount:u,cUnit:d,unitAmountPrecision:p}=(0,l._k)(),x=(0,o.useMemo)((()=>(0,_.Jp)((0,_.Jp)(n/100,c).toFixed(p,1),1).toFixed(a,1)),[p,n,a]),h=(0,o.useMemo)((()=>(0,_.Jp)((0,_.Jp)(n/100,u).toFixed(p,1),1).toFixed(a,1)),[p,n,a]),v=(0,o.useCallback)((i=>{var o;const s=+(null===(o=i.currentTarget.dataset)||void 0===o?void 0:o.stepper);s!==n?(r(s),null==t||t(s)):null==e||e()}),[t,e,n,r]);return(0,i.jsxs)(s.Z,Object.assign({sx:f},{children:[(0,i.jsx)(s.Z,Object.assign({className:"position-value",justifyContent:"flex-end"},{children:n?(0,i.jsxs)($.Z,{children:[x," ",d]},void 0):null}),void 0),(0,i.jsx)(s.Z,Object.assign({mx:"6px"},{children:q.map((e=>(0,i.jsxs)(s.Z,Object.assign({"data-stepper":e,onClick:v,className:n>=e?"container active":"container"},{children:[(0,i.jsx)(s.Z,{className:"stepper"},void 0),(0,i.jsxs)($.Z,Object.assign({className:"value"},{children:[e,"%"]}),void 0)]}),e)))}),void 0),(0,i.jsx)(s.Z,Object.assign({className:"position-value",justifyContent:"flex-start"},{children:n?(0,i.jsxs)($.Z,{children:[h," ",d]},void 0):null}),void 0)]}),void 0)})),G=()=>{const[e,t]=(0,o.useState)(""),[n]=(0,l.hN)(),[h,v]=(0,o.useState)(!1),[b,g]=(0,o.useState)(""),[f,m]=(0,o.useState)(!1),y=(0,o.useRef)(null),j=(0,o.useRef)(null),C=(0,o.useRef)(null),O=(0,o.useRef)(null),[R,S]=(0,o.useState)(0),{placeOrderReducer:k}=(0,l.b9)(),[Z,[E,N]]=(0,l.z4)(),T=(0,l.j2)(),{marginAsset:P}=T,[M,L]=(0,o.useReducer)(k,{isFetching:!1,tradeCont:0,buyCont:0,buyQty:0,sellCont:0,sellQty:0,side:1,positionSide:a.PR.LONG}),{precision:F}=(0,l.ql)({quantity:e}),B=(0,o.useCallback)((()=>{t(""),S(0),m(!1),g("")}),[]),{side:I,tradeCont:A}=M,W=n?a.RS.OPEN:a.RS.BOTH,$=1===I?a.hp.BUY:a.hp.SELL,[,_]=(0,l.e5)(),q=(0,o.useCallback)((()=>{_(!1)}),[_]),G=(0,o.useCallback)((()=>{var e;null===(e=null==O?void 0:O.current)||void 0===e||e.focus()}),[]),J=(0,o.useCallback)((()=>{m(!1),S(0),t("")}),[]),X=(0,o.useCallback)((()=>{e||J()}),[e,J]),{setMessageInfo:U}=(0,l.YT)(),K=(0,l.h5)(),V=(0,d.F)({afterSubmit:B,overrides:{positionDirection:W,timeInForce:p.rb.GTC,orderType:a.Jm.MARKET,reduceOnly:!1}});return(0,o.useEffect)((()=>{if(h){const{valid:t,message:n}=K(+A);if(!t)return g(n),U({message:n,variant:"error"}),void v(!1);V(Object.assign(Object.assign({},c.U),{buyOrderAmount:+A,sellOrderAmount:+A,side:$,unitAmount:e})),v(!1)}}),[V,$,R,A,h,K,U,e]),(0,o.useEffect)((function(){B()}),[Z,B]),(0,o.useEffect)((function(){g("")}),[e]),(0,r.Z)(C,X,["click"]),(0,i.jsxs)(z,Object.assign({visible:!0,draggableRef:y},{children:[(0,i.jsxs)(s.Z,Object.assign({ref:C,sx:{flexDirection:"column"}},{children:[(0,i.jsxs)(s.Z,Object.assign({justifyContent:"center"},{children:[(0,i.jsx)(Q,{draggableRef:y},void 0),(0,i.jsxs)(s.Z,Object.assign({height:"40px",justifyContent:"stretch",bg:"popupBg",sx:{position:"relative"}},{children:[(0,i.jsx)(w,{positionDirection:W,handleClick:()=>{L({type:x,payload:{tradeCont:(null==M?void 0:M.buyCont)||(null==M?void 0:M.buyQty)}}),v(!0),G()},type:"bid",dispatch:L},void 0),(0,i.jsx)(D,{inputRef:O,quantity:e,setQuantity:e=>{f&&!(e=>e.indexOf("%")>=0)(e)&&S(0),t(e)},dispatch:L,onFocus:()=>m(!0),submitError:b},void 0),(0,i.jsx)(w,{positionDirection:W,handleClick:()=>{L({type:x,payload:{tradeCont:(null==M?void 0:M.sellCont)||(null==M?void 0:M.sellQty)}}),v(!0),G()},type:"ask",dispatch:L},void 0)]}),void 0),(0,i.jsx)(H,{onRemove:q},void 0)]}),void 0),f&&(0,i.jsx)(Y,{percent:R,setPercent:S,precision:F,onChange:e=>{t(`${e}%`)},onClose:J},void 0)]}),void 0),(0,i.jsx)(u.Z,{symbol:Z,base:E,quote:N,ticker:T,ref:j,marginAsset:P},void 0)]}),void 0)},J=function(){const e=(0,l.Pc)(),{isExistFutureAccount:t}=e,n=(0,l._n)(),[r]=(0,l.e5)();return(0,o.useMemo)((()=>t&&n&&r?(0,i.jsx)(G,{},void 0):null),[r,t,n])}}}]);